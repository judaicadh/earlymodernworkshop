---
import { getCollection, render } from 'astro:content';
import Layout from "../../layouts/Layout.astro";

// Generate static paths for documents
export async function getStaticPaths() {
    const documents = await getCollection('documents');

    return documents.map(doc => ({
        params: {
            slug: doc.data.slug, // Only include `slug`
        },
    }));
}

const { slug } = Astro.params;

// Fetch the document by `slug`
const document = (await getCollection('documents')).find(
    doc => doc.data.slug === slug
);

if (!document) {
    console.error(`No document found for slug: ${slug}`);
    return Astro.redirect('/404'); // Redirect to 404
}

// Render the Markdown content
const { Content } = await render(document);
---
<Layout>
    <section class="py-24">
        <div class="container mx-auto px-6 lg:px-8">
            <h1 class="text-4xl font-bold mb-6">{document.data.title}</h1>
            <p class="text-gray-500 mb-4">{document.data.description}</p>
            <article class="prose max-w-none">
                <Content /> <!-- Render Markdown content -->
            </article>
        </div>
    </section>
</Layout>