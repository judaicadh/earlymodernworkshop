---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { slugifyTag } from '../../utils/slugifyTag.ts';

const docs = await getCollection('documents');
const counts = new Map<string, { label: string; count: number }>();
for (const d of docs) {
    for (const t of (d.data.tags ?? [])) {
        const s = slugifyTag(t);
        const prev = counts.get(s);
        counts.set(s, { label: prev?.label ?? t, count: (prev?.count ?? 0) + 1 });
    }
}
const tags = [...counts.entries()]
    .sort((a, b) => a[1].label.localeCompare(b[1].label));
---

<Layout>
    <section class="py-16">
        <div class="container mx-auto px-6 lg:px-8">
            <nav class="text-sm mb-6" aria-label="Breadcrumb">
                <a href="/resources" class="text-indigo-600 hover:underline">Resources</a>
                <span> / </span>
                <span class="text-gray-500">Tags</span>
            </nav>

            <h1 class="text-3xl font-bold mb-8">All Tags</h1>

            <ul class="flex flex-wrap gap-3">
                {tags.map(([slug, { label, count }]) => (
                        <li>
                            <a
                                    href={`/tags/${slug}`}
                                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-50 text-indigo-800 hover:bg-indigo-100"
                            >
                                <span>{label}</span>
                                <span class="text-xs bg-indigo-200 text-indigo-900 px-2 py-0.5 rounded-full">{count}</span>
                            </a>
                        </li>
                ))}
            </ul>
        </div>
    </section>
</Layout>