---
import { getCollection } from 'astro:content';
import yearsData from '../../content/years.json';
import Layout from "../../layouts/Layout.astro";

// Generate static paths
export async function getStaticPaths() {
    const paths = yearsData.map(year => ({
        params: { slug: year.slug },
    }));
    console.log("Generated Paths:", paths); // Debugging
    return paths;
}

const { slug } = Astro.params;

// Fetch year metadata from JSON
const yearData = yearsData.find(y => y.slug === slug);

if (!yearData) {
    return Astro.redirect('/404');
}

// Fetch documents for the selected year
const documents = (await getCollection('documents')).filter(doc => doc.data.year === yearData.year);
---
<Layout>
    <section class="relative py-24 bg-gradient-to-b from-gray-100 to-white">
        <div class="container mx-auto px-6 lg:px-8 text-center">
            <h1 class="text-5xl font-bold text-gray-800 mb-6">{yearData.title}</h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto mb-10">{yearData.description}</p>
        </div>
        <div class="container mx-auto px-6 lg:px-8">
            {documents.length > 0 ? (
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10">
                        {documents.map(doc => (
                                <a href={`/documents/${doc.data.slug}`} class="group block border rounded-lg shadow-lg hover:shadow-xl bg-white transition-all overflow-hidden">
                                    {doc.data.thumbnail && (
                                            <div class="relative h-48 overflow-hidden">
                                                <img src={doc.data.thumbnail} alt={doc.data.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform" />
                                            </div>
                                    )}
                                    <div class="p-5">
                                        <h2 class="text-2xl font-semibold text-gray-800 mb-3 group-hover:text-indigo-600 transition">{doc.data.title}</h2>
                                        <p class="text-gray-600 line-clamp-3">
                                            {doc.data.description || "No description available."}
                                        </p>
                                    </div>
                                </a>
                        ))}
                    </div>
            ) : (
                    <div class="text-center py-20">
                        <p class="text-2xl text-gray-500">
                            No documents available for <span class="font-semibold">{yearData.title}</span>.
                        </p>
                    </div>
            )}
        </div>
    </section>
</Layout>